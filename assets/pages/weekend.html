<link href="assets/css/weekend.css" rel="stylesheet"/>

<style>
	#error {
		display: none;
		color: red;
	}

	#announcements {
		font-size: 1.5em;
		padding: 0 1em;
		overflow: hidden;
		color: #eeeeee;
	}

	#announcements a {
		color: var(--color-tertiary);
	}

    .blah {
        display: none;
    }


	@media (min-width: 992px) {
		#announcements {
			display: none;
		}
		.blah {
			display: block;
			color: var(--color-white)
		}
	}

	section.weekend {
		position: absolute;
		top: 55px;
		left: 0;
		width: 100%;
		height: calc(100% - 55px);
		overflow: hidden scroll;
		z-index: 2;
	}

	.autoheight {
		margin-top: -55px;
	}

    @media (min-width: 768px) {
        .autoheight {
            margin-top: 0;
        }
    }

	footer {
		display: none;
	}
</style>

<section id="home" class="autoheight">
<div class="home-bg"></div>
</section>

<section class="weekend text-center section-padding">
	<div class="container wow animated fadeInLeft animated" data-wow-duration="1s" data-wow-delay="0.5s">
		<div class="row">
			<div class="col-lg-8 align-center">
				<h1 style="color:var(--color-secondary);" class="section ">Festival<br/>App</h1>
				<hr>
				<p class="blah">
					Op je telefoon wordt hier de belangrijke info getoond!
				</p>
				<br>
				<p id="error"> Er ging iets mis bij het laden van de aankondigingen. Probeer het later nog eens door de pagina te herladen!</p>
				<div id="announcements">
					Loading...
				</div>
			</div>
		</div>
		<hr>
<!-- 		<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="https://forms.gle/bMvG98kQp9YvuqeG8" data-wow-duration="1s" data-wow-delay="0.3s">
			<div class="button">
			<div class="imageContainer"><img src="assets/img/weekend/suit.svg" alt="Adjudication"></div>
			<span>Jureren Highland Games</span>
		</div>
			</a> -->
		<div class="row centeredButtonContainer">
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/weekend/timetable" data-wow-duration="1s" data-wow-delay="0.1s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/timetable.svg" alt="Live Timetable"></div>
					<span>Live Timetable</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/weekend/faq" data-wow-duration="1s" data-wow-delay="0.2s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/questionMark.svg" alt="FAQs"></div>
					<span>FAQs</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="https://jury.ntds.dance/heat_lists/" target="_blank" data-wow-duration="1s" data-wow-delay="0.3s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/heatList.svg" alt="Heat Lists"></div>
					<span>Heatlijsten</span>
				</div>
			</a>
   			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="https://dansschoolpendulum.nl/ntds/" target="_blank" data-wow-duration="1s" data-wow-delay="0.3s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/heatList.svg" alt="Heat Lists"></div>
					<span>Heatlijsten per danser</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/weekend/blind-date" data-wow-duration="1s" data-wow-delay="0.3">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/bracelet.svg" alt="Blind date colors"></div>
					<span>Blinddate info</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="https://portal.ntds.dance/" target="_blank" data-wow-duration="1s" data-wow-delay="0.3s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/portal.svg" alt="Portal"></div>
					<span>Portal</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/weekend/helping" data-wow-duration="1s" data-wow-delay="0.3s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/hand.svg" alt="Volunteering"></div>
					<span>VTO shift informatie</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/weekend/map-venue" data-wow-duration="1s" data-wow-delay="0.3">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/map.svg" alt="Plattegrond"></div>
					<span>Plattegrond</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/weekend/sleeping-halls" data-wow-duration="1s" data-wow-delay="0.3">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/sleep.svg" alt="Slaapzaal"></div>
					<span>Slaapzaal indeling</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/allergens" data-wow-duration="1s" data-wow-delay="0.3s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/gluten.svg" alt="Home"></div>
					<span>Allergenen</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/weekend/tc" data-wow-duration="1s" data-wow-delay="0.3s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/leader.svg" alt="Team Captain Center"></div>
					<span>Teamcaptains</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/weekend/judging" data-wow-duration="1s" data-wow-delay="0.3s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/suit.svg" alt="Adjudication"></div>
					<span>Juryleden</span>
				</div>
			</a>
			<a class="buttonContainer col-xs-6 col-sm-4 col-md-3" href="#/weekend/emergency" data-wow-duration="1s" data-wow-delay="0.3s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/weekend/emergency.svg" alt="Emergency"></div>
					<span>Noodgevallen</span>
				</div>
			</a>
			<a class="buttonContainer normalColor col-xs-6 col-sm-4 col-md-3" href="#/home" data-wow-duration="1s" data-wow-delay="0.3s">
				<div class="button">
					<div class="imageContainer"><img src="assets/img/other/logo_small.png" alt="Home"></div>
					<span>Naar de website</span>
				</div>
			</a>
		</div>
	</div>
</section>

<script src="assets/js/eocjs-newsticker.min.js"></script>
<link rel="stylesheet" href="assets/css/eocjs-newsticker.css">
<script>
	jQuery(document).ready(function ($) {
		$.noConflict();

		function getColumnIndex(sheetData, title) {
			const titles = sheetData.map(sheet => sheet[0])
			return titles.indexOf(title);
		}

		function transformData(data) {
			let announcements = data[getColumnIndex(data, 'Announcements')].slice(1).filter(a => a.trim() !== '');
			announcements = announcements.map((ann, i) => {
				return `${i+1}/${announcements.length}: ${ann}`
			})

			return announcements;
		}

		let tickerShown = false;
		function initTicker() {
			const annEl = $("#announcements")
			annEl.eocjsNewsticker({
				type: 'dynamic',
				divider: 'â€”',
				speed: 10,
				interval: 1,
				getContentArray: getAnnouncements,
			});
		}

		let announcements = [' '];
		function getAnnouncements() {
			const annEl = $("#announcements");
			if (announcements.length === 0) {
				annEl.animate({height: 0})
				return [' ']
			}

			annEl.animate({height: '1.2em'})
			return announcements;
		}

		let updateDataTimeout = null;
		function updateData() {
			if(!$('#announcements').length) {
				clearTimeout(updateDataTimeout)
				return;
			}

			fetch('https://www.ntds2025.nl/api/timetable').then(res => {
				try {
					res.json().then(data => {
						announcements = transformData(data)
						if (!tickerShown) {
							initTicker();
							tickerShown = true;
						}
					})
					updateDataTimeout = setTimeout(updateData, 5000)
				} catch (err) {
					console.error(err)
					displayError()
				}
			}).catch(err => {
				console.error(err)
				displayError()
			})
		}
		updateData()

		function displayError() {
			$("#announcements").fadeOut().promise.done(() => {
				$("#error").fadeIn()
			})
		}
	});
</script>
